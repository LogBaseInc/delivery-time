function loadCityValues(){var a={};if(1==shopifyDs.addonsOnly){myCitySelect.find("option").remove();$("#lbdt-note").html('<br>We are sorry, <font style="color:#FF0000">you cannot order a bouquet separately.</font> Please order it along with a <a href="http://www.cakebee.in/collections"> <b>cake.</b></a>')}else a="sampler"==shopifyDs.cakeType||1==shopifyDs.addons?{select:"Select city",coimbatore:"Coimbatore"}:{select:"Select city",coimbatore:"Coimbatore",trichy:"Trichy"};myCitySelect.find("option").remove(),$.each(a,function(a,b){myCitySelect.append($("<option></option>").val(a).html(b))})}function getIST(){var a=new Date,b=a.getTimezoneOffset(),c=330,d=new Date(a.getTime()+6e4*(c+b));return d}function isPlumOrder(){return 1==shopifyDs.cartJson.items.length&&"plum"==shopifyDs.cakeType}function updateFirstPossibleDeliveryDate(){if(0==lbDatePicker.data.config.defaultDateTimeChecks)return void updateDefaultDeliveryDates();var a=0,b=getIST(),c=b.getDate(),d=b.getHours(),e=lbDatePicker.data.config.workStartTime,f=lbDatePicker.data.config.workingHoursPerDay,g=e+f,h=lbDatePicker.data.config.cakeTypes[shopifyDs.cakeType].prepTime[shopifyDs.cakeVariant],i=g-d;for(i<0&&(i=0);h>i;)h-=i,a++,i=f;1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(a+=1),b.setDate(c+a),delivery.date=b.getDate(),delivery.month=b.getMonth()+1,delivery.year=b.getFullYear(),delivery.hour=d>e&&0==a?d+h+1:e+h+1,1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(delivery.hour=9)}function checkForHoliday(a){var b=!1;if(("signature"==shopifyDs.cakeType||"handcrafted"==shopifyDs.cakeType)&&a.indexOf("2017 01 14")>=0)return!0;if(0==lbDatePicker.data.config.enableSlotChecks)return!1;if(0==checkForStockAvailability(a))return!0;if($.each(lbDatePicker.data.config.holiday[shopifyDs.city],function(c,d){d.toString().indexOf(a)>=0&&(b=!0)}),1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType){if(checkForMaxOrders(a))return!0}return b}function checkForStockAvailability(a){var b=lbDatePicker.data.config.outOfStock[shopifyDs.city];if(null==b||void 0==b)return!0;var c=!0;return $.each(shopifyDs.productTitles,function(d,e){var f=b[e];if(null!=f&&void 0!=f){var g=a.split(" "),h=parseInt(g[0]),i=parseInt(g[1]),j=parseInt(g[2]);g=f.split(" ");var k=parseInt(g[0]),l=parseInt(g[1]),m=parseInt(g[2]);if(!(h>k||i>l&&h==k||j>=m&&i==l&&h==k))return void(c=!1);c=!0}}),c}function checkForMaxOrders(a){var b=0,c=!1,d=0,e=a.split(" ").join(""),f=lbDatePicker.data[shopifyDs.city][e];return null!=f&&void 0!=f&&($.each(f,function(a,c){if("11:00"==a||"15:00"==a){var e=parseInt(c);e>=lbDatePicker.data.config.maxSamplersPerSlot&&d++,b+=e}}),(b>=2*lbDatePicker.data.config.maxSamplersPerSlot||d>=2)&&(c=!0),c)}function getDates(){var a={};return $.each(lbDatePicker.dates,function(b,c){var d=b.split(" "),e=d[0],f=d[1],g=d[2];if(!checkForHoliday(b)&&(parseInt(g)>=delivery.date&&parseInt(f)==delivery.month&&parseInt(e)==delivery.year||parseInt(f)>delivery.month&&parseInt(e)==delivery.year||parseInt(e)>delivery.year)){getFreeSlotsForTheDay(g,f,e)!={}&&(a[b]=c)}}),0==Object.keys(a).length&&deliverySlotsFullNotification(),a}function getFreeSlotsForTheDay(a,b,c){var d={},e=c.toString()+b.toString()+a.toString(),f=lbDatePicker.data.config.maxOrdersPerSlot;return 1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(f=lbDatePicker.data.config.maxSamplersPerSlot),$.each(lbDatePicker.data.config.slots,function(a,b){var c=lbDatePicker.data[shopifyDs.city];if(null!=c&&void 0!=c&&(c=c[e]),null==c||void 0==c)d[a]=b;else{var g=c[a];(null==g||g<f||isPlumOrder()&&g<lbDatePicker.data.config.maxPlumOrdersPerSlot)&&(d[a]=b)}}),d}function getSlots(a){var b=a.split(" "),c=b[0],d=b[1],e=b[2],f=parseInt(e);return lbDatePicker.data.config.enableSlotChecks?slots=getFreeSlotsForTheDay(e,d,c):slots=lbDatePicker.data.config.slots,f==delivery.date?(selectedSlots={},$.each(slots,function(a,b){parseInt(a)>=delivery.hour&&(selectedSlots[a]=b)}),selectedSlots):slots}function updateCakeDs(){$.getJSON("cart.js",function(a){shopifyDs.cartJson=a;var b=[],c=[],d=[];$.each(shopifyDs.cartJson.items,function(a,e){type=e.product_type,void 0!=type&&null!=type&&b.push(type.toLowerCase()),prop=e.properties,null!=prop?(variant=e.properties["Egg/Eggless"],void 0!=variant&&null!=variant?c.push(variant.toLowerCase()):(variant=e.variant_options.toString(),c.push(variant.toLowerCase()))):(variant=e.variant_options.toString(),c.push(variant.toLowerCase())),shopifyDs.productTitles.push(e.product_title.toString()),d.push(e.title.toString().toLowerCase())}),c.toString().indexOf("eggless")>=0?shopifyDs.cakeVariant="eggless":shopifyDs.cakeVariant="egg",b.toString().indexOf("sampler")>=0?shopifyDs.cakeType="sampler":b.toString().indexOf("handcrafted")>=0?shopifyDs.cakeType="handcrafted":b.toString().indexOf("signature")>=0?(shopifyDs.signature=!0,shopifyDs.cakeType="signature"):b.toString().indexOf("add ons")>=0?shopifyDs.cakeType="signature":b.toString().indexOf("plum")>=0?shopifyDs.cakeType="plum":d.toString().indexOf("2 kg")>=0||d.toString().indexOf("2kg")>=0?shopifyDs.cakeType="xpress2kg":shopifyDs.cakeType="xpress",b.toString().indexOf("add ons")>=0&&(shopifyDs.addons=!0,1==shopifyDs.cartJson.items.length&&(shopifyDs.addonsOnly=!0)),loadCityValues(),updateFirstPossibleDeliveryDate(),noteToCustomer(),hideDeliverySlotForSampler()})}function hideDeliverySlotForSampler(){var a="";if(1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(a="For <b>Sampler cakes</b> only two delivery slots are available."),"sampler"==shopifyDs.cakeType){var b="<br><b>Sampler Cakes</b> are available only for Coimbatore. Our <b>Sampler Cakes</b> takes a day to deliver. "+a;$("#lbdt-note").html(b)}}function deliverySlotsFullNotification(){var a="";1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType?(a='<br>All delivery slots for <b style="color:#FF0000">Sampler Cakes are full</b>. Please come back tomorrow to order <b>Sampler Cakes</b>. In the mean time you can order our <a href="http://www.cakebee.in/collections/bees-xpress"><b>Xpress Cakes</b></a>.',ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Delivery Slots Full",eventLabel:"Sampler cakes delivery slots full"})):(a='<br>We are sorry, <font style="color:#FF0000">all delivery slots are fully booked for this week!</font> Please check back tomorrow or <a href="http://www.cakebee.in/pages/get-in-touch"> <b>Get in touch</b></a> with us.',ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Delivery Slots Full",eventLabel:"All cakes delivery slots full"})),$("#lbdt-note").html(a)}function noteToCustomer(){var a="";if(!("xpress"==shopifyDs.cakeType&&"egg"==shopifyDs.cakeVariant||1==shopifyDs.addonsOnly||isPlumOrder())){var b=null;b="signature"==shopifyDs.cakeType||"xpress"==shopifyDs.cakeType||"xpress2kg"==shopifyDs.cakeType?"6 hours":"1 day";var c;c="xpress"==shopifyDs.cakeType?"Eggless Xpress cakes":"xpress2kg"==shopifyDs.cakeType?"2 kg cakes":"signature"==shopifyDs.cakeType?1==shopifyDs.addons&&1==shopifyDs.signature?"bouquet & signature cakes":0==shopifyDs.addons?"signature":"bouquet":shopifyDs.cakeType+" cakes",a="xpress2kg"==shopifyDs.cakeType?"<br>Our <b>"+c+" Cakes</b> takes "+b+" to prepare. ":'<br>Our <b><font style="text-transform: capitalize;">'+c+"</font></b> takes "+b+" to deliver. ","xpress"==shopifyDs.cakeType||0!=shopifyDs.addons&&"handcrafted"!=shopifyDs.cakeType?1==shopifyDs.addons&&(a+="Bouquet is only available in Coimbatore."):a+='If you need the cakes to be delivered sooner, please choose our <a href="http://www.cakebee.in/collections/bees-xpress"><b>0.5/1 kg Xpress Cakes</b></a>.',$("#lbdt-note").html(a),$("#lbdt-note a").click(function(a){ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Cart To Xpress",eventLabel:"Perhaps needed a cake sooner"})})}}function getDefaultDates(){var a={Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thursday",Fri:"Friday",Sat:"Saturday",Sun:"Sunday"},b=0,c={},d=new Date;for(d.setDate(d.getDate()+1);b<7;){var e=d.getFullYear().toString()+" "+(d.getMonth()+1).toString()+" "+d.getDate().toString(),f=d.toDateString(),g=f.split(" ")[0];f=f.replace(g,a[g]),f=f.replace(" "+d.getFullYear(),", "+d.getFullYear()),("signature"==shopifyDs.cakeType||"handcrafted"==shopifyDs.cakeType||"xpress"==shopifyDs.cakeType)&&f.indexOf("2017 01 14")>=0||(c[e]=f),b++,d.setDate(d.getDate()+1)}lbDatePicker.dates=c}function updateDefaultDeliveryDates(){var a=getIST();if("xpress"==shopifyDs.cakeType||"plum"===shopifyDs.cakeType){var b=3;if("eggless"==shopifyDs.cakeVariant)var b=7;delivery.date=a.getDate(),delivery.hour=a.getHours()+b,delivery.month=a.getMonth()+1}else"signature"==shopifyDs.cakeType||"addons"==shopifyDs.cakeType?(delivery.date=a.getDate(),delivery.hour=a.getHours()+7,delivery.month=a.getMonth()+1):(a.setDate(a.getDate()+1),delivery.date=a.getDate(),delivery.hour=a.getHours()+1,delivery.month=a.getMonth()+1)}function getDefaultSlots(){var a={};a["10:00"]="10 - 11 am",a["11:00"]="11 - 12 pm (noon)",a["12:00"]="12 - 1 pm",a["13:00"]="1 - 2 pm",a["14:00"]="2 - 3 pm",a["15:00"]="3 - 4 pm",a["16:00"]="4 - 5 pm",a["17:00"]="5 - 6 pm",a["18:00"]="6 - 7 pm",a["19:00"]="7 - 8 pm",a["20:00"]="8 - 9 pm",lbDatePicker.data={},lbDatePicker.data.config={},lbDatePicker.data.config.slots=a,lbDatePicker.data.config.enableSlotChecks=!1,lbDatePicker.data.config.defaultDateTimeChecks=!1}function submitAction(a){if("checkout"!=shopifyDs.submitType)return!0;if(shopifyDs.submitType="update",0!=myDateSelect.val()&&"select"!=myCitySelect.val()&&"select"!=myTimeSelect.val()&&"loading"!=myCitySelect.val()){var b=$("#lbdt-city option:selected").text()+" | "+$("#lbdt-date option:selected").text()+" | "+$("#lbdt-slots option:selected").text();b=b.replace("(noon)",""),shopifyDs.cartJson.note=b,$.ajax({url:"cart/update.js",type:"POST",data:shopifyDs.cartJson,async:!1});var c="?city="+shopifyDs.city+"&date="+myDateSelect.val().split(" ").join("")+"&slot="+myTimeSelect.val()+"&notes="+b+"&price="+shopifyDs.cartJson.total_price,d="/apps/order"+c;$.ajax({url:d,type:"GET",async:!1,timeout:1e3});var e=$("#lbdt-date option:selected").text();return ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Ordered Cake - "+$("#lbdt-city option:selected").text(),eventLabel:e,eventValue:parseInt(myTimeSelect.val())}),ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Slot Selected",eventLabel:$("#lbdt-slots option:selected").text()}),!0}a.preventDefault()}var lbDatePicker={},delivery={date:0,hour:0,month:0,year:0},shopifyDs={cartJson:null,cakeVariant:null,cakeType:null,city:null,submitType:"update",productTitles:[],addons:!1,addonsOnly:!1,signature:!1};if($.ajaxSetup({timeout:1e4}),window.addEventListener("error",function(a){var b=a.colno?" line:"+a.lineno+", column:"+a.colno:" line:"+a.lineno;ga("send","event","JavaScript Error",a.message,a.filename+b+" -> "+navigator.userAgent,0,!0)}),$("#lbdt").length>0){var myDateSelect=$("#lbdt-date"),myTimeSelect=$("#lbdt-slots"),myCitySelect=$("#lbdt-city");$.get("https://shopifyapp.azurewebsites.net/shopify/dates",function(a){lbDatePicker=a,myCitySelect.prop("disabled",!1),updateCakeDs()}).fail(function(){getDefaultDates(),getDefaultSlots(),myCitySelect.prop("disabled",!1),updateCakeDs(),ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Loaded Default Slot Options",eventLabel:"Error while fetching dates from Date Picker"})}),myDateSelect.find("option").remove(),myCitySelect.find("option").remove(),myTimeSelect.find("option").remove(),myCitySelect.append($("<option></option>").val("loading").html("Loading")),myCitySelect.prop("disabled",!0),$("#checkout").click(function(a){shopifyDs.submitType="checkout"}),$("#lbdt-submit").submit(function(a){submitAction(a)}),myCitySelect.change(function(a){if($("#checkout").prop("disabled",!1),myCitySelect.val().toString().indexOf("select")<0){shopifyDs.city=myCitySelect.val();var b="";if($("#lbdt-addons").html(b),"coimbatore"==shopifyDs.city&&0==shopifyDs.addons){var b='<br><a href="http://www.cakebee.in/collections/add-ons"><b>Click here to order a bouquet</b></a> along with your cake, only available in Coimbatore.';$("#lbdt-addons").html(b)}myDateSelect.find("option").remove();var c={};c[0]="Select date",$.each(getDates(),function(a,b){c[a]=b}),$.each(c,function(a,b){myDateSelect.append($("<option></option>").val(a).html(b))})}else myDateSelect.find("option").remove(),myTimeSelect.find("option").remove()}),myDateSelect.change(function(a){if(myTimeSelect.find("option").remove(),selectedValue=$("#lbdt-date option:selected").text(),selectedValue.indexOf("Select")<0){var b={};if(b.select="Select time slot",1==shopifyDs.cartJson.items.length&&"plum"==shopifyDs.cakeType){var c=getSlots(myDateSelect.val());null!=c["12:00"]&&(b["12:00"]="10 am - 2 pm"),null!=c["17:00"]&&(b["17:00"]="4 pm - 8 pm")}else $.each(getSlots(myDateSelect.val()),function(a,c){b[a]=c});$.each(b,function(a,b){myTimeSelect.append($("<option></option>").val(a).html(b))})}})}