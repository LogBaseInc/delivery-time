function loadCityValues(){if("sampler"==shopifyDs.cakeType){var e={select:"Select city",coimbatore:"Coimbatore"};console.log("Sampler cakes selected")}else{var e={select:"Select city",coimbatore:"Coimbatore",trichy:"Trichy"};console.log("Other cakes selected")}myCitySelect.find("option").remove(),$.each(e,function(e,t){myCitySelect.append($("<option></option>").val(e).html(t))})}function getIST(){var e=new Date,t=e.getTimezoneOffset(),a=330,o=new Date(e.getTime()+6e4*(a+t));return o}function updateFirstPossibleDeliveryDate(){if(0==lbDatePicker.data.config.defaultDateTimeChecks)return void updateDefaultDeliveryDates();var e=0,t=getIST(),a=t.getDate(),o=t.getHours(),i=lbDatePicker.data.config.workStartTime,l=lbDatePicker.data.config.workingHoursPerDay,s=i+l,r=lbDatePicker.data.config.cakeTypes[shopifyDs.cakeType].prepTime[shopifyDs.cakeVariant],n=s-o;for(0>n&&(n=0);r>n;)r-=n,e++,n=l;1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(e+=1),t.setDate(a+e),delivery.date=t.getDate(),delivery.month=t.getMonth()+1,o>i&&0==e?delivery.hour=o+r+1:delivery.hour=i+r+1,1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(delivery.hour=9)}function checkForHoliday(e){var t=!1;if(0==lbDatePicker.data.config.enableSlotChecks)return!1;if($.each(lbDatePicker.data.config.holidays,function(a,o){o.toString().indexOf(e)>=0&&(t=!0)}),1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType){var a=checkForMaxOrders(e);if(a)return!0}return t}function checkForMaxOrders(e){var t=0,a=!1,o=0,i=e.split(" ").join(""),l=lbDatePicker.data[shopifyDs.city][i];return null==l||void 0==l?!1:($.each(l,function(e,a){if("11:00"==e||"15:00"==e){var i=parseInt(a);i>=lbDatePicker.data.config.maxSamplersPerSlot&&o++,t+=i}}),(t>=2*lbDatePicker.data.config.maxSamplersPerSlot||o>=2)&&(a=!0),a)}function getDates(){var e={};return $.each(lbDatePicker.dates,function(t,a){var o=t.split(" "),i=o[0],l=o[1],s=o[2];if(!checkForHoliday(t)&&(parseInt(s)>=delivery.date&&parseInt(l)==delivery.month||parseInt(l)>delivery.month)){var r=getFreeSlotsForTheDay(s,l,i);r!={}&&(e[t]=a)}}),0==Object.keys(e).length&&deliverySlotsFullNotification(),e}function getFreeSlotsForTheDay(e,t,a){var o={},i=a.toString()+t.toString()+e.toString(),l=lbDatePicker.data.config.maxOrdersPerSlot;return 1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(l=lbDatePicker.data.config.maxSamplersPerSlot),$.each(lbDatePicker.data.config.slots,function(e,t){var a=lbDatePicker.data[shopifyDs.city];if(null!=a&&void 0!=a&&(a=a[i]),null==a||void 0==a)o[e]=t;else{var s=a[e];(null==s||l>s)&&(o[e]=t)}}),o}function getSlots(e){var t=e.split(" "),a=t[0],o=t[1],i=t[2],l=parseInt(i);return lbDatePicker.data.config.enableSlotChecks?slots=getFreeSlotsForTheDay(i,o,a):slots=lbDatePicker.data.config.slots,l==delivery.date?(selectedSlots={},$.each(slots,function(e,t){parseInt(e)>=delivery.hour&&(selectedSlots[e]=t)}),selectedSlots):slots}function updateCakeDs(){$.getJSON("cart.js",function(e){shopifyDs.cartJson=e;var t=[],a=[];$.each(shopifyDs.cartJson.items,function(e,o){type=o.product_type,void 0!=type&&null!=type&&t.push(type.toLowerCase()),prop=o.properties,null!=prop?(variant=o.properties["Egg/Eggless"],void 0!=variant&&null!=variant?a.push(variant.toLowerCase()):(variant=o.variant_options.toString(),a.push(variant.toLowerCase()))):(variant=o.variant_options.toString(),a.push(variant.toLowerCase()))}),a.toString().indexOf("eggless")>=0?shopifyDs.cakeVariant="eggless":shopifyDs.cakeVariant="egg",t.toString().indexOf("sampler")>=0?shopifyDs.cakeType="sampler":t.toString().indexOf("handcrafted")>=0?shopifyDs.cakeType="handcrafted":t.toString().indexOf("signature")>=0?shopifyDs.cakeType="signature":shopifyDs.cakeType="xpress",loadCityValues(),updateFirstPossibleDeliveryDate(),noteToCustomer(),hideDeliverySlotForSampler()})}function hideDeliverySlotForSampler(){var e="";if(1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType&&(e="For <b>Sampler cakes</b> only two delivery slots are available."),"sampler"==shopifyDs.cakeType){var t="<br><b>Sampler Cakes</b> are available only for Coimbatore. Our <b>Sampler Cakes</b> takes a day to deliver. "+e;$("#lbdt-note").html(t)}}function deliverySlotsFullNotification(){var e="";1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType?(e='<br>All delivery slots for <b style="color:#FF0000">Sampler Cakes are full</b>. Please come back tomorrow to order <b>Sampler Cakes</b>. In the mean time you can order our <a href="http://www.cakebee.in/collections/bees-xpress"><b>Xpress Cakes</b></a>.',ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Delivery Slots Full",eventLabel:"Sampler cakes delivery slots full"})):(e='<br>We are sorry, <font style="color:#FF0000">all delivery slots are fully booked for this week!</font> Please check back tomorrow or <a href="http://www.cakebee.in/pages/get-in-touch"> <b>Get in touch</b></a> with us.',ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Delivery Slots Full",eventLabel:"All cakes delivery slots full"})),$("#lbdt-note").html(e)}function noteToCustomer(){if("xpress"!=shopifyDs.cakeType||"egg"!=shopifyDs.cakeVariant){var e=null;e="signature"==shopifyDs.cakeType||"xpress"==shopifyDs.cakeType?"6 hours":"1 day";var t;t="xpress"==shopifyDs.cakeType?"Eggless Xpress":shopifyDs.cakeType;var a='<br>Our <b><font style="text-transform: capitalize;">'+t+"</font> Cakes</b> takes "+e+" to prepare. ";"xpress"!=shopifyDs.cakeType&&(a+='If you need the cakes to be delivered sooner, please choose our <a href="http://www.cakebee.in/collections/bees-xpress"><b>Xpress Cakes</b></a>.'),$("#lbdt-note").html(a),$("#lbdt-note a").click(function(e){ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Cart To Xpress",eventLabel:"Perhaps needed a cake sooner"})})}}function getDefaultDates(){for(var e=0,t={},a=new Date;7>e;){var o=a.getFullYear().toString()+" "+(a.getMonth()+1).toString()+" "+a.getDate().toString();t[o]=a.toDateString(),e++,a.setDate(a.getDate()+1)}lbDatePicker.dates=t}function updateDefaultDeliveryDates(){var e=getIST();"xpress"==shopifyDs.cakeType?(delivery.date=e.getDate(),delivery.hour=e.getHours()+3,delivery.month=e.getMonth()+1):"signature"==shopifyDs.cakeType?(delivery.date=e.getDate(),delivery.hour=e.getHours()+7,delivery.month=e.getMonth()+1):(e.setDate(e.getDate()+1),delivery.date=e.getDate(),delivery.hour=e.getHours()+1,delivery.month=e.getMonth()+1)}function getDefaultSlots(){var e={};e["10:00"]="10 - 11 am",e["11:00"]="11 - 12 pm",e["12:00"]="12 - 1 pm",e["13:00"]="1 - 2 pm",e["14:00"]="2 - 3 pm",e["15:00"]="3 - 4 pm",e["16:00"]="4 - 5 pm",e["17:00"]="5 - 6 pm",e["18:00"]="6 - 7 pm",e["19:00"]="7 - 8 pm",e["20:00"]="8 - 9 pm",e["24:00"]="Midnight 11:45 - 12:00",lbDatePicker.data={},lbDatePicker.data.config={},lbDatePicker.data.config.slots=e,lbDatePicker.data.config.enableSlotChecks=!1,lbDatePicker.data.config.defaultDateTimeChecks=!1}function submitAction(e){if("checkout"!=shopifyDs.submitType)return!0;if(shopifyDs.submitType="update",0!=myDateSelect.val()&&"select"!=myCitySelect.val()&&"select"!=myTimeSelect.val()&&"loading"!=myCitySelect.val()){var t=$("#lbdt-city option:selected").text()+" | "+$("#lbdt-date option:selected").text()+" | "+$("#lbdt-slots option:selected").text();shopifyDs.cartJson.note=t,$.ajax({url:"cart.js",type:"POST",data:shopifyDs.cartJson,async:!1});var a="?city="+shopifyDs.city+"&date="+myDateSelect.val().split(" ").join("")+"&slot="+myTimeSelect.val(),o="/apps/order"+a;$.ajax({url:o,type:"GET",async:!1});var i=$("#lbdt-date option:selected").text();return ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Ordered Cake - "+$("#lbdt-city option:selected").text(),eventLabel:i,eventValue:parseInt(myTimeSelect.val())}),ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Slot Selected",eventLabel:$("#lbdt-slots option:selected").text()}),!0}e.preventDefault()}var lbDatePicker={},delivery={date:0,hour:0,month:0},shopifyDs={cartJson:null,cakeVariant:null,cakeType:null,city:null,submitType:"update"};if(window.addEventListener("error",function(e){var t=e.colno?" line:"+e.lineno+", column:"+e.colno:" line:"+e.lineno;ga("send","event","JavaScript Error",e.message,e.filename+t+" -> "+navigator.userAgent,0,!0)}),$("#lbdt").length>0){var myDateSelect=$("#lbdt-date"),myTimeSelect=$("#lbdt-slots"),myCitySelect=$("#lbdt-city");$.get("https://microsoft-apiapp54692aa0abc4415dbcbe3f2db1325121.azurewebsites.net/shopify/dates",function(e){lbDatePicker=e,myCitySelect.prop("disabled",!1),updateCakeDs()}).fail(function(){getDefaultDates(),getDefaultSlots(),myCitySelect.prop("disabled",!1),updateCakeDs(),ga("send",{hitType:"event",eventCategory:"Date Picker",eventAction:"Loaded Default Slot Options",eventLabel:"Error while fetching dates from Date Picker"})}),myDateSelect.find("option").remove(),myCitySelect.find("option").remove(),myTimeSelect.find("option").remove(),myCitySelect.append($("<option></option>").val("loading").html("Loading")),myCitySelect.prop("disabled",!0),$("#checkout").click(function(e){shopifyDs.submitType="checkout"}),$("#lbdt-submit").submit(function(e){submitAction(e)}),myCitySelect.change(function(e){if($("#checkout").prop("disabled",!1),myCitySelect.val().toString().indexOf("select")<0){shopifyDs.city=myCitySelect.val(),myDateSelect.find("option").remove();var t={};t[0]="Select date",$.each(getDates(),function(e,a){t[e]=a}),$.each(t,function(e,t){myDateSelect.append($("<option></option>").val(e).html(t))})}else myDateSelect.find("option").remove(),myTimeSelect.find("option").remove()}),myDateSelect.change(function(e){if(myTimeSelect.find("option").remove(),selectedValue=$("#lbdt-date option:selected").text(),selectedValue.indexOf("Select")<0){var t={};if(t.select="Select time slot",1==shopifyDs.cartJson.items.length&&"sampler"==shopifyDs.cakeType){var a=getSlots(myDateSelect.val());null!=a["11:00"]&&(t["11:00"]="10 am - 1 pm"),null!=a["15:00"]&&(t["15:00"]="4 pm - 7 pm")}else $.each(getSlots(myDateSelect.val()),function(e,a){t[e]=a});$.each(t,function(e,t){myTimeSelect.append($("<option></option>").val(e).html(t))})}})}